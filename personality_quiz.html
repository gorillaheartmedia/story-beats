<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Personality Wizard Quiz</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #143575;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2em;
    }
    .quiz-box {
      background: #1e2f57;
      padding: 2em;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      max-width: 600px;
      width: 100%;
    }
    .question {
      font-size: 1.3em;
      margin-bottom: 1em;
    }
    .answers button {
      display: block;
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      background: #4befff;
      color: #132752;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s;
    }
    .answers button:hover {
      background: #7de2ff;
    }
    .progress {
      text-align: center;
      margin-bottom: 1em;
      color: #a4d3ff;
    }
    .debug {
      font-size: 0.95em;
      color: #ffd370;
      margin-top: 18px;
      text-align: center;
    }
  </style>
  <script>
  getProjectId().then(projectId => {
    console.log("Current projectId:", projectId);
    if (!projectId) {
      alert("No project selected!");
      window.location.href = "dashboard.html";
    }
  });
</script>
</head>
<body>
  <div class="quiz-box">
    <div class="progress" id="progress">Question 1 of 28</div>
    <div class="question" id="questionText">Loading...</div>
    <div class="answers" id="answerButtons"></div>
  </div>
  <div id="debug" class="debug"></div>
  <script>
    // ---- Parse the id from the URL ----
    const params = new URLSearchParams(window.location.search);
    const id = parseInt(params.get("id"), 10);

    // ---- Load characters from storage ----
    const characters = JSON.parse(localStorage.getItem("characters") || "[]");
    let char = characters[id];

    // Safety fallback: If missing, create blank
    if (!char || typeof char !== "object") {
      char = {};
      characters[id] = char;
      localStorage.setItem("characters", JSON.stringify(characters));
    }

    // For debugging: show current ID and character name (if any)
    document.getElementById("debug").textContent = 
      `Current Character ID: ${id}` + 
      (char.name ? ` — Name: ${char.name}` : "");

    // ---- Quiz questions ----
    const questions = [
      // A1: Expressive vs Inner
      { text: "When facing conflict, your character is more likely to...", axis: "A1", options: [
        { text: "Withdraw and reflect", weights: { I: 2 } },
        { text: "Speak their mind instantly", weights: { E: 2 } }
      ] },
      { text: "Does your character recharge by being alone or by engaging with others?", axis: "A1", options: [
        { text: "Alone", weights: { I: 2 } },
        { text: "Others", weights: { E: 2 } }
      ] },
      { text: "They tend to express feelings...", axis: "A1", options: [
        { text: "When asked or when necessary", weights: { I: 2 } },
        { text: "As they happen", weights: { E: 2 } }
      ] },
      { text: "How does your character handle attention in public?", axis: "A1", options: [
        { text: "Avoids it or stays neutral", weights: { I: 2 } },
        { text: "Enjoys it or leans into it", weights: { E: 2 } }
      ] },
      { text: "Their opinions are often...", axis: "A1", options: [
        { text: "Thought through privately", weights: { I: 2 } },
        { text: "Shared openly and often", weights: { E: 2 } }
      ] },
      { text: "When upset, your character...", axis: "A1", options: [
        { text: "Processes it internally before speaking", weights: { I: 2 } },
        { text: "Talks it out quickly and openly", weights: { E: 2 } }
      ] },
      { text: "In a room full of people, they are likely to...", axis: "A1", options: [
        { text: "Watch and listen", weights: { I: 2 } },
        { text: "Introduce themselves and ask questions", weights: { E: 2 } }
      ] },

      // A2: Structured vs Flexible
      { text: "How does your character usually plan things?", axis: "A2", options: [
        { text: "They prefer structured steps.", weights: { S: 2 } },
        { text: "They improvise in the moment.", weights: { F: 2 } }
      ] },
      { text: "They prefer plans that...", axis: "A2", options: [
        { text: "Are specific and followed", weights: { S: 2 } },
        { text: "Can change on the fly", weights: { F: 2 } }
      ] },
      { text: "Faced with ambiguity, they...", axis: "A2", options: [
        { text: "Seek clear rules and definitions", weights: { S: 2 } },
        { text: "Go with instinct or gut", weights: { F: 2 } }
      ] },
      { text: "When solving a problem, they...", axis: "A2", options: [
        { text: "Break it down into steps", weights: { S: 2 } },
        { text: "Jump in and adapt as needed", weights: { F: 2 } }
      ] },
      { text: "In a group setting, they...", axis: "A2", options: [
        { text: "Take charge of organizing", weights: { S: 2 } },
        { text: "Prefer improvisation or brainstorming", weights: { F: 2 } }
      ] },
      { text: "When given a goal, they...", axis: "A2", options: [
        { text: "Make a detailed list or timeline", weights: { S: 2 } },
        { text: "Jump in and adjust as they go", weights: { F: 2 } }
      ] },
      { text: "Their daily life is best described as...", axis: "A2", options: [
        { text: "Scheduled and orderly", weights: { S: 2 } },
        { text: "Spontaneous and varied", weights: { F: 2 } }
      ] },

      // A3: Rational vs Emotional
      { text: "What guides their decisions more?", axis: "A3", options: [
        { text: "Logic and evidence.", weights: { R: 2 } },
        { text: "Emotion and intuition.", weights: { E: 2 } }
      ] },
      { text: "Which matters more to your character when choosing?", axis: "A3", options: [
        { text: "Logic or analysis", weights: { R: 2 } },
        { text: "Emotional connection or feeling", weights: { E: 2 } }
      ] },
      { text: "They tend to value...", axis: "A3", options: [
        { text: "Fairness and reason", weights: { R: 2 } },
        { text: "Compassion and sensitivity", weights: { E: 2 } }
      ] },
      { text: "In conflict, they’re more likely to...", axis: "A3", options: [
        { text: "Stay calm and think it through", weights: { R: 2 } },
        { text: "React based on how they feel", weights: { E: 2 } }
      ] },
      { text: "Which role fits them better?", axis: "A3", options: [
        { text: "Analyst or planner", weights: { R: 2 } },
        { text: "Counselor or empath", weights: { E: 2 } }
      ] },
      { text: "When hearing bad news, they...", axis: "A3", options: [
        { text: "Look for facts and causes", weights: { R: 2 } },
        { text: "Focus on how people are feeling", weights: { E: 2 } }
      ] },
      { text: "They value feedback that is...", axis: "A3", options: [
        { text: "Clear and constructive", weights: { R: 2 } },
        { text: "Supportive and encouraging", weights: { E: 2 } }
      ] },

      // A4: Guarded vs Bold
      { text: "In a dangerous situation, they are...", axis: "A4", options: [
        { text: "Cautious and subtle.", weights: { G: 2 } },
        { text: "Bold and direct.", weights: { B: 2 } }
      ] },
      { text: "Their presence in a room is usually...", axis: "A4", options: [
        { text: "Quiet or reserved", weights: { G: 2 } },
        { text: "Commanding or direct", weights: { B: 2 } }
      ] },
      { text: "Do they speak up when something feels wrong?", axis: "A4", options: [
        { text: "Only if pressed", weights: { G: 2 } },
        { text: "Immediately", weights: { B: 2 } }
      ] },
      { text: "They’re known for being...", axis: "A4", options: [
        { text: "Private and mysterious", weights: { G: 2 } },
        { text: "Assertive and clear", weights: { B: 2 } }
      ] },
      { text: "Faced with confrontation, they...", axis: "A4", options: [
        { text: "Deflect or retreat", weights: { G: 2 } },
        { text: "Lean into it", weights: { B: 2 } }
      ] },
      { text: "How do they ask for what they want?", axis: "A4", options: [
        { text: "Indirectly or through hints", weights: { G: 2 } },
        { text: "Clearly and directly", weights: { B: 2 } }
      ] },
      { text: "They’d rather be seen as...", axis: "A4", options: [
        { text: "Mysterious", weights: { G: 2 } },
        { text: "Powerful", weights: { B: 2 } }
      ] }
    ];

    let current = 0;
    const score = {
      A1: { I: 0, E: 0 },
      A2: { S: 0, F: 0 },
      A3: { R: 0, E: 0 },
      A4: { G: 0, B: 0 }
    };

    const questionText = document.getElementById("questionText");
    const answerButtons = document.getElementById("answerButtons");
    const progress = document.getElementById("progress");

    function showQuestion(index) {
      const q = questions[index];
      questionText.textContent = q.text;
      progress.textContent = `Question ${index + 1} of ${questions.length}`;
      answerButtons.innerHTML = "";
      q.options.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt.text;
        btn.onclick = () => {
          for (let key in opt.weights) {
            score[q.axis][key] += opt.weights[key];
          }
          current++;
          if (current < questions.length) {
            showQuestion(current);
          } else {
            finishQuiz();
          }
        };
        answerButtons.appendChild(btn);
      });
    }

    function finishQuiz() {
      // Attach results to the character and save
      char.personalityQuizScore = score;
      characters[id] = char;
      localStorage.setItem("characters", JSON.stringify(characters));

      // Optionally store globally as well
      localStorage.setItem("personalityQuizScore", JSON.stringify(score));

      // Forward the id for results page
      window.location.href = "personality_result_panel.html?id=" + id;
    }

    // Start quiz
    showQuestion(current);

  </script>
</body>
</html>
