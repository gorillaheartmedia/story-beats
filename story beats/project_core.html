<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Project Core Hub</title>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #143575 60%, #1958ca 100%);
      color: #eaf3ff;
      margin: 0;
      min-height: 100vh;
      padding: 0;
    }
    .core-container {
      max-width: 980px;
      margin: 38px auto 30px auto;
      background: rgba(24,39,70,0.97);
      border-radius: 22px;
      box-shadow: 0 6px 48px #10225244;
      padding: 50px 6vw 44px 6vw;
      border: 1.5px solid #3b82f644;
      position: relative;
      animation: fadein 0.7s;
    }
    @keyframes fadein { from { opacity: 0; transform: translateY(36px);} to {opacity:1;transform:none;} }
    .proj-title {
      font-size: 2.4em;
      color: #fff;
      margin-bottom: 7px;
      font-weight: 700;
      letter-spacing: .02em;
    }
    .proj-meta {
      color: #aee5ff;
      font-size: 1.1em;
      margin-bottom: 24px;
      font-weight: 500;
      opacity: 0.85;
    }
    .core-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 28px;
      margin-top: 32px;
      margin-bottom: 32px;
    }
    .core-tile {
      background: linear-gradient(123deg, #1b376a 77%, #348efa 97%);
      border-radius: 17px;
      box-shadow: 0 4px 24px #09337122;
      padding: 34px 18px 28px 18px;
      color: #fff;
      text-align: center;
      font-size: 1.22em;
      font-weight: 600;
      text-decoration: none;
      position: relative;
      transition: background .17s, transform .15s, box-shadow .15s;
      cursor: pointer;
      border: 1.6px solid #3b82f644;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      min-height: 140px;
    }
    .core-tile:hover {
      background: linear-gradient(110deg, #2671f2 60%, #48c6f9 100%);
      color: #e0f4ff;
      box-shadow: 0 6px 34px #3be3ff88;
      transform: translateY(-7px) scale(1.032);
      border: 2.1px solid #60a5fa;
    }
    .tile-icon {
      font-size: 2.3em;
      margin-bottom: 16px;
      display: block;
      filter: drop-shadow(0 2px 10px #4befff26);
    }
    .core-actions {
      margin-top: 18px;
      display: flex;
      gap: 18px;
      flex-wrap: wrap;
    }
    .core-actions button {
      font-size: 1.08em;
      padding: 12px 26px;
      border-radius: 9px;
      font-weight: 600;
      background: linear-gradient(92deg, #2671f2, #1958ca 100%);
      color: #fff;
      border: none;
      box-shadow: 0 2px 12px #1c378899;
      cursor: pointer;
      margin-bottom: 7px;
      transition: background .14s, color .13s;
    }
    .core-actions button:hover {
      background: linear-gradient(92deg, #2959de 0%, #60a5fa 100%);
      color: #e0f4ff;
    }
    .recent-activity {
      margin-top: 28px;
      padding: 22px 18px 9px 18px;
      background: #193772ad;
      border-radius: 14px;
      box-shadow: 0 2px 18px #17447e44;
      color: #b9e6ff;
      font-size: 1.07em;
    }
    .fab-core-hub {
      position: fixed;
      right: 32px;
      bottom: 32px;
      z-index: 9999;
      width: 74px;
      height: 74px;
      background: linear-gradient(130deg, #ffe285 60%, #1958ca 100%);
      border-radius: 50%;
      box-shadow: 0 2px 32px #ffd70088;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background .14s, box-shadow .12s;
    }
    .fab-core-hub:hover {
      background: linear-gradient(110deg, #1958ca 40%, #ffe285 100%);
      box-shadow: 0 4px 34px #ffd70088;
    }
    .fab-core-hub .fab-icon {
      font-size: 2.5em;
      color: #14283c;
      filter: drop-shadow(0 2px 4px #fffbe933);
      user-select: none;
    }
    .fab-core-hub:after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 78px;
      right: 0;
      background: #14283ccc;
      color: #fffbb0;
      padding: 6px 16px;
      border-radius: 9px;
      font-size: 1em;
      font-weight: 500;
      pointer-events: none;
      opacity: 0;
      transform: translateY(12px);
      transition: opacity .17s, transform .17s;
      white-space: nowrap;
    }
    .fab-core-hub:hover:after {
      opacity: 1;
      transform: translateY(0);
    }
    @media (max-width:700px) {
      .core-container { padding: 10px 2vw 18px 2vw; }
      .core-grid { grid-template-columns: 1fr; }
    }
    .quick-link {
      font-size: 0.95em;
      color: #b9e6ff;
      text-decoration: underline;
      cursor: pointer;
      margin-right: 20px;
    }
    .quick-link:hover { color: #ffe285; }
  </style>
</head>
<script>
  getProjectId().then(projectId => {
    console.log("Current projectId:", projectId);
    if (!projectId) {
      alert("No project selected!");
      window.location.href = "dashboard.html";
    }
  });
</script>
<body>
  <div class="core-container">
    <div class="proj-title" id="projTitle">üåü Project: [Project Name]</div>
    <div class="proj-meta" id="projMeta">
      Last updated: <span id="lastUpdated">Just Now</span> &nbsp; | &nbsp; Scenes: <span id="sceneCount">0</span> | Characters: <span id="charCount">0</span>
    </div>
    <div>
      <span class="quick-link" id="goToFirstScene" style="display:none;">Go to First Scene</span>
      <span class="quick-link" id="goToFirstCharacter" style="display:none;">Go to First Character</span>
      <span class="quick-link" id="goToFirstEvent" style="display:none;">Go to First Event</span>
    </div>
    <div class="core-grid">
      <a href="plot_engine.html" class="core-tile" data-tool="plot">
        <span class="tile-icon">üó∫Ô∏è</span>
        Plot & Story Beats
      </a>
      <a href="event_manager.html" class="core-tile" data-tool="events">
        <span class="tile-icon">üìÖ</span>
        Event Manager & Timeline
      </a>
      <a href="character_layer.html" class="core-tile" data-tool="character">
        <span class="tile-icon">üë§</span>
        Character Profiles & Life Graph
      </a>
      <a href="location_profiles.html" class="core-tile" data-tool="location">
        <span class="tile-icon">üèûÔ∏è</span>
        Locations & Settings
      </a>
      <a href="random_hub.html" class="core-tile" data-tool="random">
        <span class="tile-icon">üé≤</span>
        Randomizer Hub
      </a>
      <a href="card_prompt.html" class="core-tile" data-tool="card">
        <span class="tile-icon">üé¥</span>
        Card Prompt Tool
      </a>
        <a href="chapter_outliner.html" class="core-tile" data-tool="outliner">
        <span class="tile-icon">üìñ</span> 
        Chapter Outliner/Drafter
      </a>
      <!-- NEW TAROT TILE -->
      <a href="tarot_generator.html" class="core-tile" data-tool="tarot">
        <span class="tile-icon">üîÆ</span>
        Tarot Card Generator
      </a>
      <a href="sprint.html" class="core-tile" data-tool="sprint">
        <span class="tile-icon">‚è±Ô∏è</span>
        Sprint Tool
      </a>
      <a href="dialogue_builder.html" class="core-tile" data-tool="dialogue">
        <span class="tile-icon">üí¨</span>
        Dialogue Builder
      </a>
      <a href="wishbone.html" class="core-tile" data-tool="fishbone">
        <span class="tile-icon">üêü</span>
        Fishbone Diagram
      </a>
      <a href="node_map.html" class="core-tile" data-tool="map">
        <span class="tile-icon">üó∫Ô∏è</span>
        Node-Map
      </a>
      <a href="research.html" class="core-tile" data-tool="research">
        <span class="research">üîé</span>
        Research
      </a>
      <a href="concept_library.html" class="core-tile" data-tool="concept library">
        <span class="tile-icon">üó∫Ô∏è</span>
        Concept Library
      </a>
    </div>
    <div class="core-actions">
      <button onclick="alert('Export Coming Soon!')">üì§ Export Project</button>
      <button onclick="alert('Backup Coming Soon!')">üîí Backup Project</button>
      <button onclick="alert('Edit project details coming soon!')">‚úèÔ∏è Edit Details</button>
    </div>
    <div class="recent-activity">
      <b>Recent Activity</b><br>
      <ul id="activityFeed">
        <li>Project created.</li>
      </ul>
    </div>
  </div>
  <!-- Floating Core Hub button -->
  <div class="fab-core-hub" data-tooltip="You Are Home!">
    <span class="fab-icon">üè†</span>
  </div>
  <script>
    // --- Carry forward projectId, characterId, sceneId, eventId, and set up page links ---
    (function ensureProjectContext() {
      function getQueryParam(name) {
        let params = new URLSearchParams(window.location.search);
        return params.get(name);
      }
      let projectId = getQueryParam('id') || sessionStorage.getItem('currentPlotProjectId') || localStorage.getItem('currentProjectId');
      let characterId = getQueryParam('characterId');
      let sceneId = getQueryParam('sceneId');
      let eventId = getQueryParam('eventId');
      if (!projectId) {
        alert("No project selected. Returning to dashboard.");
        window.location.href = "dashboard.html";
        return;
      }
      sessionStorage.setItem('currentPlotProjectId', projectId);
      localStorage.setItem('currentProjectId', projectId);

      document.addEventListener("DOMContentLoaded", function() {
        // Update all tool links to always pass context
        document.querySelectorAll('.core-tile').forEach(function(tile) {
          let href = tile.getAttribute('href');
          if (href) {
            let url = href.split('?')[0]; // Remove any existing query string
            let params = [`id=${encodeURIComponent(projectId)}`];
            if (tile.dataset.tool === "character" && characterId) params.push(`characterId=${encodeURIComponent(characterId)}`);
            if (tile.dataset.tool === "plot" && sceneId) params.push(`sceneId=${encodeURIComponent(sceneId)}`);
            if (tile.dataset.tool === "events" && eventId) params.push(`eventId=${encodeURIComponent(eventId)}`);
            if (tile.dataset.tool === "tarot" && sceneId) params.push(`sceneId=${encodeURIComponent(sceneId)}`); // For Tarot
            tile.setAttribute('href', url + '?' + params.join('&'));
          }
        });
        // Fab always brings you back to this core with context
        let fab = document.querySelector('.fab-core-hub');
        if (fab) {
          fab.onclick = function() {
            let url = "project_core.html?id=" + encodeURIComponent(projectId);
            if (characterId) url += "&characterId=" + encodeURIComponent(characterId);
            if (sceneId) url += "&sceneId=" + encodeURIComponent(sceneId);
            if (eventId) url += "&eventId=" + encodeURIComponent(eventId);
            window.location.href = url;
          };
        }

        // Load project info
        try {
          let projects = JSON.parse(localStorage.getItem("plotProjects") || "[]");
          let proj = projects.find(p => p.id === projectId);
          if (proj) {
            document.getElementById('projTitle').textContent = 'üåü Project: ' + (proj.meta?.storyTitle || "(Untitled)");
            document.getElementById('lastUpdated').textContent = new Date(proj.lastModified || Date.now()).toLocaleString();
            // Scene and character counts (customize for your structure)
            document.getElementById('sceneCount').textContent = Array.isArray(proj.beats) ? proj.beats.length : 0;
            document.getElementById('charCount').textContent = Array.isArray(proj.characters) ? proj.characters.length : 0;

            // Show quick links if any
            if (proj.beats && proj.beats.length) {
              let link = document.getElementById('goToFirstScene');
              link.style.display = '';
              link.onclick = function() {
                let url = "plot_engine.html?id=" + encodeURIComponent(projectId) + "&sceneId=" + encodeURIComponent(proj.beats[0].id);
                if (characterId) url += "&characterId=" + encodeURIComponent(characterId);
                if (eventId) url += "&eventId=" + encodeURIComponent(eventId);
                window.location.href = url;
              }
            }
            if (proj.characters && proj.characters.length) {
              let link = document.getElementById('goToFirstCharacter');
              link.style.display = '';
              link.onclick = function() {
                let url = "character_layer.html?id=" + encodeURIComponent(projectId) + "&characterId=" + encodeURIComponent(proj.characters[0].id);
                if (sceneId) url += "&sceneId=" + encodeURIComponent(sceneId);
                if (eventId) url += "&eventId=" + encodeURIComponent(eventId);
                window.location.href = url;
              }
            }
            if (proj.events && proj.events.length) {
              let link = document.getElementById('goToFirstEvent');
              link.style.display = '';
              link.onclick = function() {
                let url = "event_manager.html?id=" + encodeURIComponent(projectId) + "&eventId=" + encodeURIComponent(proj.events[0].id);
                if (sceneId) url += "&sceneId=" + encodeURIComponent(sceneId);
                if (characterId) url += "&characterId=" + encodeURIComponent(characterId);
                window.location.href = url;
              }
            }
            // Recent activity (use up to last 5 logs or events)
            let ul = document.getElementById('activityFeed');
            ul.innerHTML = "";
            let logs = proj.activityLog || [];
            if (logs.length) {
              logs.slice(-5).reverse().forEach(log => {
                let li = document.createElement('li');
                li.textContent = log;
                ul.appendChild(li);
              });
            } else {
              ul.innerHTML = "<li>Project created.</li>";
            }
          }
        } catch(e){}
      });
    })();
  </script>
</body>
</html>
