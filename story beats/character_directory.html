<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Character Directory</title>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #143575 60%, #1958ca 100%);
      color: #e8ecfa;
      margin: 0; min-height: 100vh;
    }
    .container {
      max-width: 1100px;
      margin: 38px auto 28px auto;
      background: rgba(24,39,70,0.98);
      border-radius: 18px;
      box-shadow: 0 4px 32px #06103a66;
      padding: 38px 30px 42px 30px;
      border: 1.5px solid #3b82f644;
      animation: fadein 0.7s;
    }
    @keyframes fadein { from { opacity: 0; transform: translateY(36px);} to {opacity:1;transform:none;} }
    h1 {
      font-size: 2.2em;
      margin-bottom: 18px;
      color: #fff;
    }
    .add-btn {
      background: linear-gradient(92deg, #3282f0, #2b71ea 80%);
      color: #fff;
      border: none;
      border-radius: 9px;
      font-weight: 600;
      font-size: 1.14em;
      padding: 13px 36px;
      margin-bottom: 30px;
      cursor: pointer;
      transition: background .15s, color .14s;
      box-shadow: 0 2px 14px #10399a28;
      margin-right: 17px;
      margin-top: 0;
    }
    .add-btn:hover {
      background: linear-gradient(92deg, #2959de 0%, #60a5fa 100%);
      color: #e0f4ff;
    }
    .directory-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 28px;
      justify-content: flex-start;
    }
    .char-card {
      background: rgba(255,255,255,0.09);
      border: 2px solid #2953a930;
      border-radius: 16px;
      box-shadow: 0 2px 16px #0a194e33;
      width: 265px;
      min-width: 220px;
      max-width: 100%;
      padding: 0 0 18px 0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: box-shadow .17s, border .15s;
      position: relative;
    }
    .char-img-bar {
      width:100%;
      height:165px;
      background: #18357b;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
    }
    .char-img-bar img {
      max-width:100%;
      max-height:100%;
      object-fit:cover;
      display:block;
    }
    .char-card .char-body {
      padding: 17px 21px 0 21px;
      flex:1;
      display:flex;
      flex-direction:column;
      align-items: flex-start;
      width: 100%;
    }
    .char-card h2 {
      font-size: 1.24em;
      color: #b7d8fd;
      font-weight: 600;
      margin: 0 0 4px 0;
      width: 100%;
      overflow-wrap: anywhere;
    }
    .char-field {
      color:#aee5ff;
      font-size:.97em;
      font-weight:600;
      margin-bottom: 2px;
    }
    .char-traits {
      color:#e8ecfa;
      font-size:.99em;
      margin-bottom: 7px;
      opacity: .85;
      width: 100%;
      word-break: break-word;
      overflow-wrap: anywhere;
    }
    .card-actions {
      margin-top:10px;
      display:flex;
      gap:10px;
      width: 100%;
      justify-content: flex-end;
    }
    .view-btn {
      background: linear-gradient(92deg, #2671f2, #2959de 90%);
      color: #fff;
      border: none;
      border-radius: 7px;
      font-weight: 600;
      font-size: 1.02em;
      padding: 7px 18px;
      cursor: pointer;
      transition: background .15s, color .13s;
      box-shadow: 0 1px 4px #10399a24;
    }
    .view-btn:hover {
      background: linear-gradient(92deg, #2959de 0%, #60a5fa 100%);
      color: #e0f4ff;
    }
    .del-btn {
      background: linear-gradient(92deg, #a42034, #eb486b 90%);
      color: #fff;
      border: none;
      border-radius: 7px;
      font-weight: 600;
      font-size: 1.02em;
      padding: 7px 14px;
      cursor: pointer;
      transition: background .14s, color .14s;
    }
    .del-btn:hover {
      background: linear-gradient(92deg, #b22234 0%, #fc6f96 100%);
      color: #fff;
    }
    @media (max-width:900px) {
      .directory-grid { gap: 12px;}
      .char-card { width: 98vw; max-width: 340px;}
    }
    @media (max-width:600px) {
      .container { padding: 7px 1vw 15px 1vw; }
      .char-card { min-width: 140px; }
    }
.fab-research {
  position: fixed;
  right: 32px;
  bottom: 32px;
  z-index: 9999;
  width: 62px;
  height: 62px;
  background: linear-gradient(130deg, #4befff 60%, #1958ca 100%);
  border-radius: 50%;
  box-shadow: 0 2px 22px #2b7aff66;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background .14s, box-shadow .12s;
}
.fab-research:hover {
  background: linear-gradient(110deg, #1958ca 40%, #4befff 100%);
  box-shadow: 0 4px 34px #3be3ff99;
}
.fab-research .fab-icon {
  font-size: 2em;
  color: #14283c;
  filter: drop-shadow(0 2px 4px #fffbe933);
  user-select: none;
}
.fab-research:after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 78px;
  right: 0;
  background: #14283ccc;
  color: #fffbb0;
  padding: 6px 16px;
  border-radius: 9px;
  font-size: 1em;
  font-weight: 500;
  pointer-events: none;
  opacity: 0;
  transform: translateY(12px);
  transition: opacity .17s, transform .17s;
  white-space: nowrap;
}
.fab-research:hover:after {
  opacity: 1;
  transform: translateY(0);
}
</style>
<script src="project-safety.js"></script>
<script>
  getProjectId().then(projectId => {
    console.log("Current projectId:", projectId);
    if (!projectId) {
      alert("No project selected!");
      window.location.href = "dashboard.html";
    }
  });
</script>

</head>
<body>
  <div class="fab-research" data-tooltip="Open Research Archive" onclick="window.open('research.html','_blank')">
  <span class="fab-icon">ðŸ§ </span>
</div>
  <div class="container">
    <h1>Character Directory</h1>
    <div style="margin-bottom:18px;">
  <a href="relationship_grid.html" style="color:#aee5ff; text-decoration:underline; font-size:1.07em">
    ðŸ§­ View Relationship Grid
  </a>
  <span style="font-size:.96em; color:#b9d8fc; opacity:.75;">(visual map of all major character bonds)</span>
</div>
    <button class="add-btn" onclick="addCharacter()">+ Add Character</button>
    <div class="directory-grid" id="directoryGrid"></div>
    
  </div>
  <script>
    // --- LOAD & RENDER CHARACTERS ---
    const characters = JSON.parse(localStorage.getItem("characters") || "[]");
    function addCharacter() {
      const blankChar = {
        name: "", gender: "", age: "", birthday: "",
        ethnicity: "", height: "", weight: "", bodyType: "",
        eyeColor: "", hairColor: "", hairLength: "", birthplace: "",
        parent1: "", parent2: "", income: "", occupationalHistory: "",
        worstEnemy: "", bestFriend: "", neutralAlly: "", siblings: "",
        spouse: "", maritalStatus: "Single", relationshipHistory: "",
        role: "Protagonist", description: "", skill: "", power: "", trinket: "",
        licenses: [], locMorning: "", locAfternoon: "", locEvening: "", locNight: "",
        lastSeenLocation: "", lastSeenTime: "", ethics: "Lawful Good", ethicsNotes: "",
        tags: [], image: "", timeline: []
      };
      characters.push(blankChar);
      localStorage.setItem("characters", JSON.stringify(characters));
      window.location.href = 'character_profile.html?id=' + (characters.length - 1);
    }
    function renderDirectory() {
      const grid = document.getElementById("directoryGrid");
      grid.innerHTML = "";
      if (!characters.length) {
        grid.innerHTML = `<div style="color:#aee5ff;font-size:1.19em;padding:30px 0;width:100%;text-align:center;">No characters yet.<br/>Click "+ Add Character" to get started!</div>`;
        return;
      }
      characters.forEach((char, idx) => {
        const img = char.image || "https://via.placeholder.com/230x165?text=No+Image";
        const role = char.role || "";
        const gender = char.gender || "";
        const age = char.age ? `Age: ${char.age}` : "";
        const summary = char.description || char.traits || char.bodyType || "";
        grid.innerHTML += `
        <div class="char-card">
          <div class="char-img-bar">
            <img src="${img}" alt="${char.name || "Unnamed"}">
          </div>
          <div class="char-body">
            <h2>${char.name || "Unnamed"}</h2>
            <div class="char-field">${role}${role && gender ? " â€¢ " : ""}${gender}${(role || gender) && age ? " â€¢ " : ""}${age}</div>
            <div class="char-traits">${summary}</div>
            <div class="card-actions">
              <button class="view-btn" onclick="window.location.href='character_profile.html?id=${idx}'">View Profile</button>
              <button class="del-btn" onclick="deleteCharacter(${idx})">Delete</button>
            </div>
          </div>
        </div>
        `;
      });
    }
    function deleteCharacter(idx) {
      if (!confirm("Delete this character?")) return;
      characters.splice(idx, 1);
      localStorage.setItem("characters", JSON.stringify(characters));
      renderDirectory();
    }
    renderDirectory();
  </script>
</body>
</html>
