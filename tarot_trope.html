<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trope Tarot Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #3b0a45 60%, #9c27b0 100%);
      color: #eaf3ff;
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    .tarot-container {
      max-width: 580px;
      margin: 60px auto 40px auto;
      background: rgba(30, 12, 50, 0.95);
      border-radius: 20px;
      box-shadow: 0 6px 38px #2e003e77;
      padding: 40px 30px 32px 30px;
      border: 1.5px solid #b347ff44;
      position: relative;
      animation: fadein 0.7s;
    }
    @keyframes fadein { 
      from { opacity: 0; transform: translateY(40px);} 
      to {opacity:1;transform:none;}
    }
    h1 {
      color: #fff;
      margin-bottom: 7px;
      letter-spacing: .02em;
      font-size: 2.1em;
      font-weight: 700;
      text-align: center;
    }
    .top-nav {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .return-btn {
      background: linear-gradient(92deg, #b347ff, #8e24aa 90%);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1em;
      padding: 8px 18px;
      cursor: pointer;
      transition: background .15s, color .14s;
    }
    .return-btn:hover {
      background: linear-gradient(92deg, #8e24aa 0%, #d05ce3 100%);
    }
    .tarot-btns {
      display: flex;
      justify-content: center;
      gap: 18px;
      margin: 22px 0 26px 0;
      flex-wrap: wrap;
    }
    .tarot-btn {
      font-size: 1.09em;
      padding: 10px 25px;
      border-radius: 8px;
      background: linear-gradient(92deg, #b347ff, #8e24aa 90%);
      color: #fff;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: background .17s, color .13s, box-shadow .13s;
      box-shadow: 0 2px 12px #4a006224;
      outline: none;
    }
    .tarot-btn:hover {
      background: linear-gradient(92deg, #8e24aa 0%, #d05ce3 100%);
      color: #f7e9ff;
    }
    .tarot-cards-row {
      display: flex;
      justify-content: center;
      gap: 18px;
      margin-top: 36px;
      flex-wrap: wrap;
    }
    .tarot-card {
      background: linear-gradient(140deg, #4a148c 70%, #ab47bc 120%);
      color: #fff;
      border-radius: 15px;
      box-shadow: 0 4px 20px #1f003377;
      width: 142px;
      min-height: 198px;
      padding: 18px 12px 14px 12px;
      text-align: center;
      transition: transform .23s cubic-bezier(.71,1.7,.77,1.24);
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: flipIn 0.68s cubic-bezier(.21,.78,.47,1.32);
    }
    @keyframes flipIn {
      0% {transform: rotateY(90deg) scale(.89);}
      68% {transform: rotateY(-22deg) scale(1.08);}
      100% {transform: rotateY(0deg) scale(1);}
    }
    .tarot-card .tarot-name {
      font-size: 1.1em;
      font-weight: 600;
      margin-bottom: 6px;
      color: #ffd6f6;
    }
    .tarot-card .tarot-orientation {
      font-size: 0.93em;
      font-style: italic;
      margin-bottom: 6px;
      color: #ffb7e2;
    }
    .tarot-card .tarot-meaning {
      font-size: .94em;
      color: #ffeefc;
      margin-top: 7px;
    }
    .tarot-footer {
      margin-top: 32px;
      font-size: .97em;
      text-align: center;
      color: #e6c6ff;
      opacity: .78;
    }
    /* Orbit FAB */
    .orbit-fab, .orbit-child-fab {
      position: fixed;
      right: 32px;
      bottom: 32px;
      z-index: 3000;
      width: 64px; height: 64px;
      border-radius: 50%;
      background: linear-gradient(130deg, #ffd6f6 70%, #8e24aa 100%);
      box-shadow: 0 2px 30px #ff77c188;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background .14s, box-shadow .12s, transform .19s;
      font-size: 2em;
    }
    .orbit-fab:hover {
      background: linear-gradient(110deg, #8e24aa 30%, #ffd6f6 100%);
      box-shadow: 0 6px 40px #ff77c1bb;
    }
    .orbit-child-fab {
      opacity: 0;
      pointer-events: none;
      background: linear-gradient(130deg, #ab47bc 60%, #8e24aa 100%);
      font-size: 1.8em;
      box-shadow: 0 1px 14px #8e24aa44;
      transition:
        opacity 0.22s cubic-bezier(.7,2,.77,1.5),
        transform 0.26s cubic-bezier(.7,2,.77,1.5);
    }
    .orbit-child-fab[data-tooltip]:after {
      content: attr(data-tooltip);
      position: absolute;
      right: 70px;
      top: 15px;
      background: #2d0038cc;
      color: #fffbb0;
      padding: 6px 16px;
      border-radius: 9px;
      font-size: 1em;
      font-weight: 500;
      pointer-events: none;
      opacity: 0;
      transform: translateY(12px);
      transition: opacity .17s, transform .17s;
      white-space: nowrap;
    }
    .orbit-child-fab:hover:after {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
  <script>
  getProjectId().then(projectId => {
    console.log("Current projectId:", projectId);
    if (!projectId) {
      alert("No project selected!");
      window.location.href = "dashboard.html";
    }
  });
</script>
</head>
<body>
  <div class="tarot-container">
    <div class="top-nav">
      <button class="return-btn" onclick="window.location.href='core.html'">⬅ Return to Core Project</button>
    </div>
    <h1>Trope Tarot Generator</h1>
    <div class="tarot-btns">
      <button class="tarot-btn" onclick="drawTarot(1)">Draw 1 Card</button>
      <button class="tarot-btn" onclick="drawTarot(3)">Draw 3 Cards</button>
      <button class="tarot-btn" onclick="drawTarot(5)">Draw 5 Cards</button>
      <button class="tarot-btn" onclick="shuffleTarot()">Shuffle Deck</button>
    </div>
    <div id="tarotResults" class="tarot-cards-row"></div>
    <div class="tarot-footer">
      <b>Pro Tip:</b> Shuffle often for fresh inspiration — tropes may appear reversed!
    </div>
  </div>
<script>
const tropeDeck = [
  // --- Mixed Tropes + Prompts ---
  { name: "The Reluctant Hero", upright: "A protagonist thrust into a journey they never wanted, finding courage along the way.", reversed: "Avoidance of responsibility, fear of growth, sabotaging the call." },
  { name: "Villain with a Cause", upright: "An antagonist whose motives have depth and complexity.", reversed: "Petty cruelty, selfish ambition, no real justification." },
  { name: "Betrayal from Within", upright: "An ally or friend undermines the group from the inside.", reversed: "False suspicion, paranoia, trust issues clouding judgement." },
  { name: "The Mentor", upright: "Guidance, wisdom, and a push toward self-discovery.", reversed: "Manipulation disguised as wisdom, ulterior motives." },
  { name: "Doomed Romance", upright: "A love that is passionate but destined to fail.", reversed: "Missed opportunity, fear of intimacy, love never pursued." },
  { name: "Hidden Prophecy", upright: "Clues about fate are hidden in plain sight.", reversed: "Misinterpreted omens, reliance on false predictions." },
  { name: "False Utopia", upright: "A seemingly perfect world hiding deep flaws.", reversed: "Corruption laid bare, anarchy replaces the illusion." },
  { name: "Rivalry", upright: "Two forces pushing each other toward greatness or destruction.", reversed: "Petty disputes, sabotage, pointless competition." },
  { name: "The Chosen One", upright: "Destined for greatness, fate has chosen them.", reversed: "Refusal of destiny, questioning the prophecy." },
  { name: "Corrupt Authority", upright: "Leaders exploiting their power for personal gain.", reversed: "Failed uprising, replacing one corrupt regime with another." },
  { name: "Twist Ending", upright: "An unexpected reversal changes everything.", reversed: "Cheap shock with no payoff, undermining the story's logic." },
  { name: "Forbidden Knowledge", upright: "Secrets too dangerous to reveal.", reversed: "Knowledge misunderstood or dismissed." },
  { name: "Ancient Evil", upright: "A great darkness stirs after centuries of slumber.", reversed: "False alarm, misidentified threat." },
  { name: "Comic Relief", upright: "Lightheartedness amidst tension.", reversed: "Tone-breaking, undermining the stakes." },
  { name: "The MacGuffin", upright: "An object that drives the plot forward.", reversed: "Revealed as meaningless or irrelevant." },
  { name: "Survivor's Guilt", upright: "Living with the burden of being the one who lived.", reversed: "Denial of loss, avoiding grief entirely." },
  { name: "Hidden Ally", upright: "An unexpected friend reveals their loyalty.", reversed: "Ally withdraws support at the worst moment." },
  { name: "Rags to Riches", upright: "A rise from humble beginnings to great success.", reversed: "Squandering fortune, losing touch with one's roots." },
  { name: "The Last Stand", upright: "Defending until the bitter end.", reversed: "Retreat under pressure, abandoning the cause." },
  { name: "Fated Encounter", upright: "Two characters meet in a way that changes both forever.", reversed: "Missed meeting, fate delayed indefinitely." },
  { name: "Unreliable Narrator", upright: "The truth is hidden behind bias or deception.", reversed: "Revealed to be more truthful than expected." },
  { name: "Deal with the Devil", upright: "A desperate bargain with dire consequences.", reversed: "Loophole exploited, escaping the deal." },
  { name: "Haunted Past", upright: "Events from before shape every present choice.", reversed: "Forgetting key lessons, false memories." },
  { name: "Enemy Turned Ally", upright: "An adversary becomes a trusted partner.", reversed: "Ally betrays once more, cycle repeats." },
  { name: "Time Loop", upright: "Events repeat until a condition is met.", reversed: "Cycle broken prematurely, leaving loose ends." },
  { name: "Secret Identity", upright: "Living a double life to protect oneself or others.", reversed: "Identity exposed, danger increases." },
  { name: "The Red Herring", upright: "A false lead distracts from the truth.", reversed: "Accidental revelation of the real answer." },
  { name: "Poetic Justice", upright: "Karma delivers the perfect ending.", reversed: "Injustice prevails, moral imbalance remains." },
  { name: "The Sacrifice", upright: "Giving up something precious for the greater good.", reversed: "Needless loss, sacrifice for the wrong cause." },
  { name: "The Unlikely Alliance", upright: "Opposites unite to overcome a challenge.", reversed: "Alliance collapses under tension." }
];

let shuffledTarot = [];

function shuffleTarot() {
  shuffledTarot = tropeDeck.slice();
  for (let i = shuffledTarot.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffledTarot[i], shuffledTarot[j]] = [shuffledTarot[j], shuffledTarot[i]];
  }
  document.getElementById("tarotResults").innerHTML = "";
}

function drawTarot(num) {
  if (!shuffledTarot.length) shuffleTarot();
  const results = [];
  let tempDeck = shuffledTarot.slice();
  for (let i = 0; i < num; i++) {
    if (!tempDeck.length) break;
    const idx = Math.floor(Math.random() * tempDeck.length);
    let card = tempDeck.splice(idx, 1)[0];
    let reversed = Math.random() < 0.5;
    results.push({ ...card, isReversed: reversed });
  }
  displayTarotResults(results);
}

function displayTarotResults(cards) {
  let div = document.getElementById("tarotResults");
  div.innerHTML = "";
  cards.forEach(c => {
    div.innerHTML += `
      <div class="tarot-card">
        <div class="tarot-name">${c.name}${c.isReversed ? " (Reversed)" : ""}</div>
        <div class="tarot-orientation">${c.isReversed ? "Reversed" : "Upright"}</div>
        <div class="tarot-meaning">${c.isReversed ? c.reversed : c.upright}</div>
      </div>
    `;
  });
}

// Orbit FAB Logic
document.addEventListener('DOMContentLoaded', () => {
  const coreFab = document.getElementById('coreFab');
  const fabIDs = ['fab-home'];
  const childFabs = fabIDs.map(id=>document.getElementById(id));
  let fabOpen = false;

  coreFab.onclick = function() {
    fabOpen = !fabOpen;
    childFabs.forEach((fab, i) => {
      if (fabOpen) {
        fab.style.opacity = '1';
        fab.style.pointerEvents = 'auto';
        const angle = 180 + i*30;
        const rad = angle * Math.PI / 180;
        const dist = 90;
        fab.style.transform = `translate(${Math.cos(rad)*dist}px, ${-Math.sin(rad)*dist}px) scale(1.03)`;
      } else {
        fab.style.opacity = '0';
        fab.style.pointerEvents = 'none';
        fab.style.transform = 'translate(0,0) scale(.91)';
      }
    });
  };

  document.addEventListener('click', function(e){
    if(fabOpen && !coreFab.contains(e.target) && !childFabs.some(fab=>fab.contains(e.target))){
      fabOpen = false;
      childFabs.forEach(fab=>{
        fab.style.opacity='0';
        fab.style.pointerEvents='none';
        fab.style.transform='translate(0,0) scale(.91)';
      });
    }
  });

  shuffleTarot();
});
</script>

<!-- Orbit FAB HTML -->
<div id="coreFab" class="orbit-fab">☰</div>
<div id="fab-home" class="orbit-child-fab" data-tooltip="Core Project" onclick="window.location.href='project_core.html'">🏠</div>
</body>
</html>
